import{g as D,b as y,c as u}from"./axios-82560e1f.js";import{u as w}from"./usePayload-a22dd8be.js";import{s as v,r as b,o as l,c as d,a,b as g,F as m,e as k,d as _,i as f,f as p,g as h,n as E,t as I}from"./index-88ca2046.js";import{_ as V}from"./_plugin-vue_export-helper-c27b6911.js";const j={setup(){const t=w(),{payload:e}=v(t);return{payload:e}},data(){return{date:"",attributes:[{dot:!0,highlight:!0,excludeDates:[]}],disabledDates:[],times:[],availabilities:[],showError:!1,showError2:!1}},async mounted(){const t=new Date,e=new Date;e.setDate(t.getDate()-1);const n=t.setMonth(t.getMonth()+1),i={start:null,end:e},s={start:n,end:null};this.disabledDates.push(i),this.disabledDates.push(s),this.availabilities=await D(),this.getDisabledDate()},methods:{formatDate(t){return new Date(t).toISOString().slice(0,10)},getDayFromDate(t){return new Date(t).toLocaleString("en-us",{weekday:"long"}).toLowerCase()},checkIfTimeIsTaken(t,e){return!(this.times.length>0&&this.times.find(n=>this.formatDate(t)===n.reservation_date&&n.start_time===e))},objIsEmpty(t){for(let e in t)if(t[e]==="")return!1;return!0},async addReservation(){this.objIsEmpty(this.payload)?(this.showError=!1,(await y(this.payload)).status===200?this.$router.push({name:"finish"}):this.showError2=!0):this.showError=!0},async getDisabledDate(){let t=new Date;const e=new Date().setMonth(new Date().getMonth()+1);for(this.times=await u(this.formatDate(t),this.formatDate(e));t<=e;){let n=0,i=0;for(const s of this.availabilities)s.day===this.getDayFromDate(t)&&(i++,this.checkIfTimeIsTaken(t,s.start_time)||n++);if(i===n){const s=t.getFullYear(),r=t.getMonth(),c=t.getDate();this.disabledDates.push({start:new Date(s,r,c),end:new Date(s,r,c)})}t.setDate(t.getDate()+1)}}},watch:{async date(){this.payload.reservation_date=this.formatDate(this.date),this.times=[],this.times=await u(this.formatDate(this.date),this.formatDate(this.date))}}},T={class:"join-container"},S={class:"window"},C=a("h3",null,"Sélectionner une date",-1),M={class:"join-date-container"},F={class:"join-times-container"},R=["onClick"],x=a("hr",null,null,-1),N=a("h3",null,"Indiquer vos informations",-1),q={class:"join-inputs-container"},z={class:"join-input-container"},B=a("label",{class:"label",for:"last-name"},"Nom",-1),L={class:"join-input-container"},P=a("label",{class:"label",for:"first-name"},"Prénom",-1),U={class:"join-footer"},A={key:0,class:"color-error"},J={key:1,class:"color-error"};function O(t,e,n,i,s,r){const c=b("v-date-picker");return l(),d("div",T,[a("div",S,[C,a("div",M,[g(c,{attributes:s.attributes,"disabled-dates":s.disabledDates,modelValue:s.date,"onUpdate:modelValue":e[0]||(e[0]=o=>s.date=o)},null,8,["attributes","disabled-dates","modelValue"]),a("div",F,[(l(!0),d(m,null,k(s.availabilities,o=>(l(),d(m,null,[o.day===r.getDayFromDate(s.date)&&r.checkIfTimeIsTaken(s.date,o.start_time)?(l(),d("div",{key:0,class:E(["time-button",{active:i.payload.start_time===o.start_time}]),onClick:p(Q=>{i.payload.start_time=o.start_time,i.payload.end_time=o.end_time},["prevent"])},I(o.start_time.slice(0,5)),11,R)):h("",!0)],64))),256))])]),x,N,a("div",q,[a("div",z,[B,_(a("input",{required:"","onUpdate:modelValue":e[1]||(e[1]=o=>i.payload.last_name=o),class:"input",placeholder:"Nom",id:"last-name"},null,512),[[f,i.payload.last_name]])]),a("div",L,[P,_(a("input",{required:"","onUpdate:modelValue":e[2]||(e[2]=o=>i.payload.first_name=o),class:"input",placeholder:"Prénom",id:"first-name"},null,512),[[f,i.payload.first_name]])])]),a("div",U,[a("button",{class:"button",onClick:e[3]||(e[3]=p(o=>r.addReservation(),["prevent"]))},"Réserver"),s.showError?(l(),d("span",A,"Veuillez sélectionner une date et remplir les informations")):h("",!0),s.showError2?(l(),d("span",J,"Quelqu'un d'autre à déjà choisi cette heure ! Soyez plus rapide !")):h("",!0)])])])}const W=V(j,[["render",O]]);export{W as default};
