import{g as D,b as y,c as h}from"./axios-1df0811e.js";import{u as w}from"./usePayload-595aa45f.js";import{s as v,r as b,o as r,c as l,a,b as g,F as m,d as k,f as u,h as _,e as f,i as c,n as I,t as T}from"./index-aa831d5c.js";import{_ as E}from"./_plugin-vue_export-helper-c27b6911.js";const V={setup(){const e=w(),{payload:t}=v(e);return{payload:t}},data(){return{date:"",attributes:[{dot:!0,highlight:!0,excludeDates:[]}],disabledDates:[],times:[],availabilities:[],showError:!1,showError2:!1}},async mounted(){const e=new Date,t=new Date;t.setDate(e.getDate()-1);const d=e.setMonth(e.getMonth()+1),s={start:null,end:t},o={start:d,end:null};this.disabledDates.push(s),this.disabledDates.push(o),this.availabilities=await D(),this.getDisabledDate()},methods:{formatDate(e){return new Date(e).toISOString().slice(0,10)},getDayFromDate(e){return new Date(e).toLocaleString("en-us",{weekday:"long"}).toLowerCase()},checkIfTimeIsTaken(e){return!(this.times&&this.times.find(t=>t.start_time===e))},checkIfTimeIsNotTaken(e){return!(this.times&&this.times.find(t=>t.start_time!==e))},objIsEmpty(e){for(let t in e)if(e[t]==="")return!1;return!0},async addReservation(){this.objIsEmpty(this.payload)?(this.showError=!1,(await y(this.payload)).status===200?this.$router.push({name:"finish"}):this.showError2=!0):this.showError=!0},async getDisabledDate(){const e=new Date().setMonth(new Date().getMonth()+1);this.times=await h(this.formatDate(new Date),this.formatDate(e));let t=0,d=0;for(const s of this.availabilities)s.day==this.getDayFromDate(new Date)&&(d++,this.checkIfTimeIsTaken(s.start_time)||t++);if(d===t){const s=new Date().getFullYear(),o=new Date().getMonth(),n=new Date().getDate();this.disabledDates.push({start:new Date(s,o,n),end:new Date(s,o,n)})}}},watch:{async date(){this.payload.reservation_date=this.formatDate(this.date),this.times=[],this.times=await h(this.formatDate(this.date),this.formatDate(this.date))}}},j={class:"join-container"},M={class:"window"},S=a("h3",null,"Sélectionner une date",-1),C={class:"join-date-container"},F={class:"join-times-container"},N=["onClick"],R=a("hr",null,null,-1),x=a("h3",null,"Indiquer vos informations",-1),q={class:"join-inputs-container"},L={class:"join-input-container"},z=a("label",{class:"label",for:"last-name"},"Nom",-1),B={class:"join-input-container"},P=a("label",{class:"label",for:"first-name"},"Prénom",-1),U={class:"join-footer"},A={key:0,class:"color-error"},J={key:1,class:"color-error"};function O(e,t,d,s,o,n){const p=b("v-date-picker");return r(),l("div",j,[a("div",M,[S,a("div",C,[g(p,{attributes:o.attributes,"disabled-dates":o.disabledDates,modelValue:o.date,"onUpdate:modelValue":t[0]||(t[0]=i=>o.date=i)},null,8,["attributes","disabled-dates","modelValue"]),a("div",F,[(r(!0),l(m,null,k(o.availabilities,i=>(r(),l(m,null,[i.day===n.getDayFromDate(o.date)&&n.checkIfTimeIsTaken(i.start_time)?(r(),l("div",{key:0,class:I(["time-button",{active:s.payload.start_time===i.start_time}]),onClick:f(Q=>{s.payload.start_time=i.start_time,s.payload.end_time=i.end_time},["prevent"])},T(i.start_time.slice(0,5)),11,N)):c("",!0)],64))),256))])]),R,x,a("div",q,[a("div",L,[z,u(a("input",{required:"","onUpdate:modelValue":t[1]||(t[1]=i=>s.payload.last_name=i),class:"input",placeholder:"Nom",id:"last-name"},null,512),[[_,s.payload.last_name]])]),a("div",B,[P,u(a("input",{required:"","onUpdate:modelValue":t[2]||(t[2]=i=>s.payload.first_name=i),class:"input",placeholder:"Prénom",id:"first-name"},null,512),[[_,s.payload.first_name]])])]),a("div",U,[a("button",{class:"button",onClick:t[3]||(t[3]=f(i=>n.addReservation(),["prevent"]))},"Réserver"),o.showError?(r(),l("span",A,"Veuillez sélectionner une date et remplir les informations")):c("",!0),o.showError2?(r(),l("span",J,"Quelqu'un d'autre à déjà choisi cette heure ! Soyez plus rapide !")):c("",!0)])])])}const W=E(V,[["render",O]]);export{W as default};
